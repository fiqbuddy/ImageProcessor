version: '3.8'

services:
  # ============================================================================
  # DEVICE 5: ORCHESTRATOR (MASTER)
  # Coordinates the pipeline across other devices
  # ============================================================================
  orchestrator:
    build: .
    container_name: orchestrator
    command: python -u services/orchestrator_service.py
    ports:
      - "50055:50055"
    environment:
      # -----------------------------------------------------------------------
      # CONFIGURATION: Static IPs with defaults
      # -----------------------------------------------------------------------

      # Device 1 IP (Resize Node) - Single instance
      - RESIZE_SERVICE_HOSTS=${RESIZE_IP:-100.120.161.53}:50052

      # Device 2 IP (Filter Node) - Single instance
      - FILTER_SERVICE_HOSTS=${FILTER_IP:-100.71.209.102}:50053

      # Device 3 IP (Watermark Node) - Single instance
      - WATERMARK_SERVICE_HOSTS=${WATERMARK_IP:-100.115.248.53}:50054

      # Device 4 IP (Format Node) - Single instance
      - FORMAT_SERVICE_HOSTS=${FORMAT_IP:-100.71.185.127}:50056

      - PYTHONUNBUFFERED=1
